// @flow

import WithPost from '../../components/WithPost';

export default WithPost({
  "attributes": {
    "timestamp": 1376169022000,
    "title": "RSS a Sitemap jednoduše a rychle",
    "slug": "rss-a-sitemap-jednoduse-a-rychle"
  },
  "body": "<p>Pár článků zpět jsem ukazoval několik příkladů, jak tvořit různé routy. Ukazoval jsem routy pro RSS i sitemap.xml. Nikde jsem však zatím neukazoval jak je to jednoduše realizovatelné. Dokonce tak jednoduše, že je škoda tyto soubory nevyužít na jakémkoliv webu, protože mají poměrně velký potenciál.</p>\n<p>Začněme HomepagePresenterem (DEV Nette):</p>\n<pre><code class=\"hljs lang-php\"><span class=\"hljs-meta\">&lt;?php</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HomepagePresenter</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">BasePresenter</span> </span>{\n\n    <span class=\"hljs-comment\">/** <span class=\"hljs-doctag\">@var</span> \\Model\\Posts <span class=\"hljs-doctag\">@inject</span> */</span>\n    <span class=\"hljs-keyword\">public</span> $posts;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">renderRss</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;template-&gt;posts = <span class=\"hljs-keyword\">$this</span>-&gt;posts-&gt;getAllPosts()-&gt;order(<span class=\"hljs-string\">'date DESC'</span>)-&gt;limit(<span class=\"hljs-number\">50</span>);\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">renderSitemap</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;template-&gt;sitemap = <span class=\"hljs-keyword\">$this</span>-&gt;posts-&gt;getAllPosts();\n    }\n\n}\n</code></pre>\n<p>Tímto říkám, že do šablon <code>rss.latte</code> a <code>sitemap.latte</code> předávám všechny články, nebo jen některé, protože nechci dělat dump celé databáze pro RSS.</p>\n<p>Pro úplnost ještě \\Model\\Posts:</p>\n<pre><code class=\"hljs lang-php\"><span class=\"hljs-meta\">&lt;?php</span>\n\n<span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">Model</span>;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Posts</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">Nette</span>\\<span class=\"hljs-title\">Object</span> </span>{\n\n    <span class=\"hljs-comment\">/** <span class=\"hljs-doctag\">@var</span> \\Nette\\Database\\SelectionFactory <span class=\"hljs-doctag\">@inject</span> */</span>\n    <span class=\"hljs-keyword\">public</span> $sf;\n\n    <span class=\"hljs-comment\">/**\n     * <span class=\"hljs-doctag\">@return</span> Nette\\Database\\Table\\Selection\n     */</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getAllPosts</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;sf-&gt;table(<span class=\"hljs-string\">'posts'</span>);\n    }\n\n}\n</code></pre>\n<p>A následují samotné šablony, které musí dodržovat určitý formát, takže se lehce odlišují od normálních šablon. Sitemap.latte:</p>\n<pre><code class=\"hljs lang-html\">{contentType application/xml}\n<span class=\"php\"><span class=\"hljs-meta\">&lt;?</span>xml version=<span class=\"hljs-string\">\"1.0\"</span> encoding=<span class=\"hljs-string\">\"UTF-8\"</span><span class=\"hljs-meta\">?&gt;</span></span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">urlset</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.sitemaps.org/schemas/sitemap/0.9\"</span>&gt;</span>\n    {foreach $sitemap as $s}\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">loc</span>&gt;</span>{link //Single:article $s-&gt;id}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">loc</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n    {/foreach}\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">urlset</span>&gt;</span>\n</code></pre>\n<p>Rss.latte:</p>\n<pre><code class=\"hljs lang-html\">{contentType application/xml}\n<span class=\"php\"><span class=\"hljs-meta\">&lt;?</span>xml version=<span class=\"hljs-string\">\"1.0\"</span> encoding=<span class=\"hljs-string\">\"UTF-8\"</span><span class=\"hljs-meta\">?&gt;</span></span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">rss</span> <span class=\"hljs-attr\">version</span>=<span class=\"hljs-string\">\"2.0\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">channel</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Martin Zlámal [BLOG]<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span>&gt;</span>{link //:Homepage:default}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">link</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">description</span>&gt;</span>Nejnovější články na blogu.<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">description</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">language</span>&gt;</span>cs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">language</span>&gt;</span>\n\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">item</span> <span class=\"hljs-attr\">n:foreach</span>=<span class=\"hljs-string\">\"$posts as $post\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>{$post-&gt;title}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span>&gt;</span>{link //:Single:article $post-&gt;id}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">link</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">description</span>&gt;</span>{$post-&gt;body|texy|striptags}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">description</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">item</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">channel</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">rss</span>&gt;</span>\n</code></pre>\n<p>A pro úplnou úplnost i router:</p>\n<pre><code class=\"hljs lang-php\"><span class=\"hljs-meta\">&lt;?php</span>\n\n<span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">App</span>;\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">Nette</span>;\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">Nette</span>\\<span class=\"hljs-title\">Application</span>\\<span class=\"hljs-title\">Routers</span>\\<span class=\"hljs-title\">Route</span>;\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">Nette</span>\\<span class=\"hljs-title\">Application</span>\\<span class=\"hljs-title\">Routers</span>\\<span class=\"hljs-title\">RouteList</span>;\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">Nette</span>\\<span class=\"hljs-title\">Application</span>\\<span class=\"hljs-title\">Routers</span>\\<span class=\"hljs-title\">SimpleRouter</span>;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RouterFactory</span> </span>{\n\n    <span class=\"hljs-comment\">/**\n     * <span class=\"hljs-doctag\">@return</span> \\Nette\\Application\\IRouter\n     */</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">createRouter</span><span class=\"hljs-params\">()</span> </span>{\n        $router = <span class=\"hljs-keyword\">new</span> RouteList();\n        $router[] = <span class=\"hljs-keyword\">new</span> Route(<span class=\"hljs-string\">'sitemap.xml'</span>, <span class=\"hljs-string\">'Homepage:sitemap'</span>);\n        <span class=\"hljs-comment\">// na RSS se dá odkazovat normálně bez routeru, nebo:</span>\n        $router[] = <span class=\"hljs-keyword\">new</span> Route(<span class=\"hljs-string\">'rss.xml'</span>, <span class=\"hljs-string\">'Homepage:rss'</span>);\n        <span class=\"hljs-comment\">//...</span>\n        $router[] = <span class=\"hljs-keyword\">new</span> Route(<span class=\"hljs-string\">'&lt;presenter&gt;/&lt;action&gt;[/&lt;id&gt;]'</span>, <span class=\"hljs-string\">'Homepage:default'</span>);\n        <span class=\"hljs-keyword\">return</span> $router;\n    }\n\n}\n</code></pre>\n<p>Jednoduché a na pár řádek. Jen vědět jak na to... (-:</p>\n"
});
