export default {
  "attributes": {
    "id": "098b3cf2-dc80-4c7f-b02b-c5918cc1c94c",
    "timestamp": 1459632882000,
    "title": "Magie zvaná mapping presenterů",
    "slug": "magie-zvana-mapping-presenteru"
  },
  "body": "Ona to vlastně ani není taková magie jako to není nikde pořádně popsané. Než se pustím to obludných složitostí, bylo by vhodné zmínit se co to vlastně mapping presenterů je. Viděli jste někde toto v konfiguraci?\n\n```neon\napplication:\n\tmapping:\n\t\t*: App\\*Module\\Presenters\\*Presenter\n```\n\nUrčitě ano, je to totiž vykopírované ze sandboxu. Tato konfigurace říká, kde má Nette hledat presentery. Resp. pod jakým **namespace**. To je důležité. Na adresářové struktuře totiž v tomto případě vůbec nezáleží. Kdyby v konfiguračním souboru nebyl mapping vůbec uvedený, presenter by musel být bez namespace, tedy například `\\HomepagePresenter`. Pokud by pak zase někdo měl raději MVC, mohl by si jednoduše změnit mapping:\n\n```neon\napplication:\n\tmapping:\n\t\t*: App\\*Module\\Controllers\\*Controller\n```\n\nA používat tak třídu `\\App\\Controllers\\HomepageController`. Opět na umístění v adresářové struktuře nezávisle. Pojďme se ale ponořit hlouběji a rozeberme si co vlastně jednotlivé části mappingu znamenají.\n\n# Do hlubin regulárů\n\nNejdůležitější metodou je v tomto případě `\\Nette\\Application\\PresenterFactory::setMapping`. V této metodě se ukrývá tento regulární výraz, který kontroluje validitu mappingu (preg_match):\n\n```\n#^\\\\\\\\?([\\w\\\\\\\\]*\\\\\\\\)?(\\w*\\*\\w*?\\\\\\\\)?([\\w\\\\\\\\]*\\*\\w*)\\z#\n```\n\nV této obludnosti se skrývají 3 části. Ale zjednodušeně řečeno rozdělí tento regulární výraz mapping na prefix, část s modulem a část s presenterem. Tedy například takto:\n\n```\n                                           App\\\nApp\\*Module\\Presenters\\*Presenter    =>    *Module\\\n                                           Presenters\\*Presenter\n```\n\nZ toho jak je regulár napsaný by mělo být zřejmé, že lze první i druhou část vynechat. Všechny následující mappingy jsou tedy validní:\n\n```\n*Module\\Presenters\\*Presenter\nApp\\Presenters\\*Presenter\nPresenters\\*Presenter\n*Presenter\nPresenter*\n*\n```\n\nTak moment. Co vlastně znamenají ty hvězdičky? Zjednoušeně hvězdička značí proměnný název presenteru (Homepage v HomepagePresenter) a pokud jsou v mappingu dvě hvězdičky, tak první značí proměnnný název modulu (nebo všech zanořených modulů) aplikace. Nejpochopitelnější bude vyzkoušet si tu nejjedodušší formu mappingu:\n\n```neon\napplication:\n\tmapping:\n\t\t*: *\n```\n\nNa hvězdičku před dvojtečkou zatím nehleďme. Nette teď bude hledat prostě jen třídu `\\Homepage` (resp. podle definice routeru). Pokud budeme mít modulární aplikaci, tak se bude hledat `<Admin>Module\\Homepage` (opět záleží na routeru). Pokud trošku pozměníme mapping, musí to už být úplně jasné:\n\n```neon\napplication:\n\tmapping:\n\t\t*: *\\*\n```\n\nNette teď nebude nic řešit. Řekněme že máme router nastavený tak, aby destination bylo `Front:Homepage:default`. V při tomto mappingu se bude hledat přesenter s názvem `\\Front\\Homepage`. Ještě uvedu jeden příklad, aby to bylo úplně zřejmé. Teď nebudu mít destination v routě jen `Homepage:default` a mapping nastavím takto:\n\n```neon\napplication:\n\tmapping:\n\t\t*: App\\Presenters\\*Presenter\n```\n\nPřesně tak, bude se to chovat úplně stejně jako první příklad. Když totiž aplikace nepracuje s moduly, tak se druhá část toho velkého reguláru zahazuje. Než se dostanu k limitním případům, kdy je mapping omezující, rozeberme si ještě konfigurační část před dvojtečkou (klíč pole). Do této chvíli všude byla jen hvězdička. To znamená, že se tento mapping aplikuje na všechny příchozí požadavky. Se vzrůstající složitostí projektu však může přijít požadavek, že chceme mapovat jinak administraci a jinak zbytek aplikace. Routování by mohlo být třeba takové:\n\n```php\npublic static function createRouter()\n{\n\t$router = new RouteList;\n\t$router[] = new Route('test', 'Admin:Homepage:default');\n\t$router[] = new Route('<presenter>/<action>[/<id>]', 'Homepage:default');\n\treturn $router;\n}\n```\n\nA mapping:\n\n```neon\napplication:\n\tmapping:\n\t\t*: App\\*Module\\Presenters\\*Presenter\n        Admin: App\\Controllers\\*Controller\n```\n\nTakže vše bude mapováno pomocí první masky, ale pro `Admin` modul bude používat MVC jako v druhé ukázce. Tohoto se dá velmi dobře využít pokud stavíte aplikaci pomocí [rozšíření pro DIC](rozsireni-pro-dic). V tomto případě je totiž docela dobrý nápad mít presentery ve vlastní namespace a tedy vytvořit si pro ně nový mapping, který bude mapovat jen tuto část aplikace. Používám to hodně.\n\n# Limitující případy\n\nCo vím, tak existují dva limitující případy s tím, že ten druhý je vyřešen v budoucí verzi Nette Application (zatím jen dev-master). Na první případ narážím velmi často. Bohužel totiž není možné (pokud vím) definovat více mappingů pro jeden modul. Nejde tak vytvořit mapping třeba pro modul API a zároveň mapping, který by využíval stejný modul, ale byl umístěn v úplně jiném namespace (bundle). To je při tvorbě bundles hodně limitující. Tento problém je vyřešen ve skvělé knihovně [librette/presenter-factory](https://github.com/librette/presenter-factory). Celkově se v Librette skrývá spoustu pokladů, jen <del>Kdyby</del> je autor nějak dokumentoval... ;-)\n\nDruhý případ je dobře popsán v [tomto issue](https://github.com/nette/application/issues/101). Totiž jak jsem se letmo zmínil dříve, tak pokud existuje více zanořených modulů, tak se maska pro moduly opakuje. Ale ne tak, jak by bylo občas potřeba. Mějme například tento mapping z issue #101:\n\n```neon\napplication:\n\tmapping:\n\t\t*: App\\Module\\*Module\\Presenter\\*Presenter\n```\n\nPokud budeme mít v routeru nadefinováno více zanoření modulů (`A:B:Homepage:default`), tak se bude hledat tento presenter:\n\n```\nApp\\Module\\AModule\\BModule\\Presenter\\HomepagePresenter\n```\n\nTo docela dává smysl, že? Jenže ne vždy je to vhodné chování a lepší by bylo, aby se pro moduly opakovala větší část definice a hledaný presenter se ve skutečnosti jmenoval takto:\n\n```\nApp\\Module\\AModule\\Module\\BModule\\Presenter\\HomepagePresenter\n```\n\nToho však nelze se současným mappingem jednoduše dosáhnout. Řešením je právě vývojová verze balíčku Nette\\Application, kde lze mapping nadefinovat také pomocí pole:\n\n```neon\napplication:\n\tmapping:\n\t\t*: [App, Module\\*Module, Presenter\\*Presenter]\n```\n\nVyřešení takové mappingu je už jednoduché a aplikace se chová přesně podle očekávání. Původní chování samozřejmě zůstává stejné. Při tomto novém zápisu opět platí vše co jsem již psal, jen je třeba dodržet pořadí v poli:\n\n```neon\napplication:\n\tmapping:\n\t\t*: ['', *, *]    #nebo *\\*\n```\n\nTedy opět je hledaný presenter `Front\\Homepage` při routeru nastaveném na `Front:Homepage:default`. A poslední příklad uvedu přepsaný první příklad podle tohoto alternativního přístupu:\n\n```neon\napplication:\n\tmapping:\n\t\t*: [App, *Module, Presenters\\*Presenter]\n```\n\nVíc o tom asi nejde napsat, protože je to přesně takto jednoduché... :)"
}
