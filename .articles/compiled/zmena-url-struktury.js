export default {
  "attributes": {
    "id": "dbf85219-5173-4c7b-924a-636e86172b93",
    "timestamp": 1382905620000,
    "title": "Změna URL struktury",
    "slug": "zmena-url-struktury"
  },
  "body": "Rád bych tímto upozornil na změny URL adres na tomto webu. A zároveň k technické povaze tohoto webu\nprozradím i bližší informace ze zákulisí.\n\nPřed úpravou URL struktury jsem definoval několik důležitých bodů, kterých jsem se držel:\n1. Musí zůstat maximální (úplná) zpětná kompatibilita\n2. Výsledné URL musí být maximálně jednoduché a cool\n\n# Předtím a potom\n\nDůležité je, aby stará URL adresa nekončila chybou 404, ale aby přesměrovala na novou URL.\nRSS je nyní na adrese http://zlml.cz/rss. Původně bylo na adrese http://zlml.cz/homepage/rss.\nObě dvě adresy fungují stále, rozdíl je v tom, že homepage/rss nyní přesměrovává pomocí 301 na */rss.\nToho se dalo docílit velice jednoduše:\n\n```php\n$router[] = new Route('rss', 'Homepage:rss'); //nová routa\n$router[] = new Route('<presenter>/<action>[/<id>]', 'Homepage:default'); //původní\n//záleží na pořadí!\n```\n\nAčkoliv je teď druhá routa zbytečná, nechal jsem jí pro případ, že bych měl nějakou URL nezachycenou.\nV tom případě ji zachytí tato obecná.\n\n# Zpětná kompatibilita\n\nStejně tak jako změna adresy RSS, tak si i ostatní adresy musí zachovat stejné vlastnosti viz první bod.\nA vzhledem k tomu, že jsem se rozhodl změnit adresu vyhledávání a tagů, nezbývalo, než další\ndvě routy přidat. Opět záleží na pořadí:\n\n```php\n$router[] = new Route('s[/<search>]', 'Search:default'); //nová\n$router[] = new Route('t[/<search>]', 'Tag:default'); //nová\n\n//tyto routy (až uznám za vhodné) mohu smazat:\n$router[] = new Route('search[/<search>]', 'Search:default', Route::ONE_WAY); //původní\n$router[] = new Route('tag[/<search>]', 'Tag:default', Route::ONE_WAY); //původní\n```\n\nOpět platí, že funguje jak stará adresa http://zlml.cz/search/nette s přesměrováním 301, tak i nová \nhttp://zlml.cz/s/nette. Obdobně je tomu u tagů.\n\n# Čarodějnictví!\n\nNejvětší sranda však začíná u druhého požadavku. Už dlouho jsem si pohrával s myšlenkou,\nže chci názvy článků a adresy jednotlivých stránek v menu hned za lomítkem jako v kořenovém\nadresáři. Tedy aby článek měl adresu http://zlml.cz/lovec-matematik a stránka http://zlml.cz/about.\nZde jsem se však vždy dostával do velkého problému. Jak rozlišit a nabídnout z databáze článek a \njak poznat, kdy naopak nabídnout stránku například s referencemi?\n\nNo, tak nejdříve je zapotřebí routa pro články:\n```php\n$router[] = new Route('<slug>', 'Single:article');\n```\nKdy v presenteru tahám články z databáze podle slugu:\n```php\npublic function renderArticle($slug) {\n\t$post = $this->posts->getBySlug($slug)->fetch(); //načetní článku podle slugu\n\tif (!$post) { //článek neexistuje (db vrací FALSE)\n\t\t$this->forward($slug); //nabídni statickou šablonu\n\t} else { // zobrazení článku\n    \t//...\n    }\n}\n```\nCož je podle mého dostatečně elegantní řešení. Jednoduše se pokusím o načtení stránky podle slugu\nz databáze a když se to nepodaří, nabídnu nějaký latte soubor, pokud existuje. Pokud neexistuje, \ntak ErrorPresenter již obstará vrácení 404, což je správně, protože není co nabídnout...\n\nJeště je zapotřebí vytvořit jednu routu:\n```php\n$router[] = new Route('<action>', 'Single:article');\n```\nBez této routy by to také fungovalo, ale latte ony latte soubory (action) bych našel na dvou URL\nadresách, což nechci. Takže se z původního http://zlml.cz/single/about dostanu na http://zlml.cz/about, \ncož je cool a splňuji tak druhý požadavek.\n\nPoslední routa, která stojí za zmíňku pak zajišťuje stránkování. Pouze rozpoznává čísla podle\nregulárního výrazu a podle toho stránkuje:\n```php\n$regex = '1|2|3'; //zjednodušeně\n$router[] = new Route(\"[<paginator-page [$regex]>]\", array(\n\t'presenter' => 'Homepage',\n\t'action' => 'default',\n\t'paginator-page' => 1\n));\n```\n\nOstatně to jak mám v době psaní tohoto článku router vytvořený můžete zjistit na [bitbucketu](https://bitbucket.org/mrtnzlml/zlml.cz/src/0580e2e9f0e4edb162fe97ad563cfef766bea625/app/router/RouterFactory.php).\n"
}
